#!/bin/sh

get_emoji_code() {
    case "$1" in
        "build")    echo ":building_construction:" ;;
        "ci")       echo ":construction_worker:" ;;
        "feat")     echo ":sparkles:" ;;
        "fix")      echo ":bug:" ;;
        "perf")     echo ":zap:" ;;
        "refactor") echo ":recycle:" ;;
        "style")    echo ":lipstick:" ;;
        "docs")     echo ":memo:" ;;
        "test")     echo ":test_tube:" ;;
        "chore")    echo ":wrench:" ;;
        "revert")   echo ":rewind:" ;;
        "workflow") echo ":clipboard:" ;;
        "security") echo ":lock:" ;;
        *)          echo "" ;;
    esac
}

commit_msg=$(cat "$1")

type=$(echo "$commit_msg" | awk -F':' '/^(build|ci|feat|fix|perf|refactor|style|docs|test|chore|revert|workflow|security)/ {print $1}')

if [ -z "$type" ]; then
    echo "âŒ Invalid commit type!"
    echo "Allowed types:" 
    echo "â€¢ build ğŸ—ï¸"
    echo "â€¢ ci ğŸ‘·"
    echo "â€¢ feat âœ¨"
    echo "â€¢ fix ğŸ›"
    echo "â€¢ perf âš¡"
    echo "â€¢ refactor â™»ï¸"
    echo "â€¢ style ğŸ’„"
    echo "â€¢ docs ğŸ“"
    echo "â€¢ test ğŸ§ª"
    echo "â€¢ chore ğŸ”§"
    echo "â€¢ revert âª"
    echo "â€¢ workflow ğŸ“‹"
    echo "â€¢ security ğŸ”’"
    echo ""
    echo "Expected format: <type>(<scope>): <subject>"
    echo "Example: feat(auth): add email login"
    exit 1
fi
 
# subjet=$(echo "$commit_msg" | cut -d ':' -f2- | xargs)
# if [ ${#subjet} -gt 50 ]; then
#     echo "âŒ Commit subject is too long (max 50 characters)"
#     exit 1
# fi

emoji_code=$(get_emoji_code "$type")
if [ -z "$(echo "$emoji_code")" ]; then
    echo "$commit_msg" > "$1"
    exit 0
fi

echo "$emoji_code $commit_msg" > "$1"

echo "âœ… Commit message is valid! added emoji"

exit 0
